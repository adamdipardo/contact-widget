# Contact Widget

The widget provides the front-end for the contact tool.

## File Overview

### app.html

This file represents the initial view of the contact form and contains the basic fields and elements. The form will then be changed and manipulated via JavaScript.

### contact.js

This is the JavaScript code for the widget. It handles everything from loading the campaign, geocoding (using Google), AJAX requests to dynamically show matched ridings, field validation, and finally submitting the form.

### contact.scss

This contains CSS for the widget. Gulp will automatically build the resulting CSS and add it to contact.css (for dev), or inline it with `app.html` for the final dist version.

### index.html

This file is used as a container for displaying the widget during development. The widget code is contained here, and can be changed to load different campaigns. This is for development purposes only.

### widget.js

This is the chunk of JavaScript that the widget embed code calls, and handles setting up the widget via an iFrame.It will create the iFrame and point it to the `app.html` file. 

## build

This folder will hold the output of the `gulp`, and `gulp build-only` commands. It is ignored in git, and files inside should not be edited directly. Changes to the widget code will automatically be copied here.

## dist

This folder will hold production-ready versions of the widget files, `app.html` and `widget.js`. These files are generated by the `gulp create-dist` command (see Building below)

## site

This folder holds the site container that is used to display the widget while developing. This is where the development server will point to. There is only one file, `index.html`, which is copied from root.

## Requirements

For local development, the widget expects that the API will be available at `http://127.0.0.1:8005`. The development webserver opens a proxy from `/api` to this address.

## Installation

1. Clone the repository and in a terminal run `npm install`

## Development

1. Launch the widget by running the command `gulp --env=local`
2. You can now view the widget inside an HTML page by opening your browser to `http://127.0.0.1:8000`

## Building

### Production

1. Run `gulp build-only --env=production`
2. Run `gulp create-dist --env=production`
3. Upload the `app.html` and `widget.js` files from the `dist` directory to the server
  1. For the Upstream GoDaddy server, the files should be uploaded to the `/api/public/widget` directory, overwriting the old widget files.

### Dev

1. Run `gulp build-only --env=dev`
2. Run `gulp create-dist --env=dev`
3. Upload the `app.html` and `widget.js` files from the `dist` directory to the development server.
